{"version":3,"file":"messenger.min.js","sources":["../src/messenger.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript module for WhatsApp Messenger block.\n *\n * @package    block_whatsapp_messenger\n * @copyright  2024 CentricApp LTD (https://centricapp.co.il)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n    return {\n        init: function(courseid) {\n            $('#whatsapp-message-form').on('submit', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var recipient = $('#recipient-select').val();\n                var message = $('#message-text').val();\n\n                if (!message.trim()) {\n                    Notification.addNotification({\n                        message: 'Please enter a message',\n                        type: 'error'\n                    });\n                    return;\n                }\n\n                var $btn = $('#send-whatsapp-btn');\n                var $status = $('#whatsapp-status');\n\n                $btn.prop('disabled', true).text('Sending...');\n                $status.removeClass('alert-success alert-danger').text('');\n\n                // Use Moodle's AJAX API with External Services\n                Ajax.call([{\n                    methodname: 'block_whatsapp_messenger_send_message',\n                    args: {\n                        courseid: courseid,\n                        recipient: parseInt(recipient),\n                        message: message\n                    },\n                    done: function(response) {\n                        if (response.success) {\n                            $status.addClass('alert alert-success').text(response.message);\n                            $('#message-text').val('');\n                            \n                            Notification.addNotification({\n                                message: response.message,\n                                type: 'success'\n                            });\n                        } else {\n                            $status.addClass('alert alert-danger').text(response.message);\n                            Notification.addNotification({\n                                message: response.message,\n                                type: 'error'\n                            });\n                        }\n                    },\n                    fail: function(error) {\n                        var errorMsg = 'Error sending message';\n                        if (error.message) {\n                            errorMsg = error.message;\n                        }\n                        $status.addClass('alert alert-danger').text(errorMsg);\n                        Notification.addNotification({\n                            message: errorMsg,\n                            type: 'error'\n                        });\n                    },\n                    always: function() {\n                        $btn.prop('disabled', false).text('Send Message');\n                    }\n                }]);\n\n                return false;\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","init","courseid","on","e","preventDefault","stopPropagation","recipient","val","message","trim","$btn","$status","prop","text","removeClass","call","methodname","args","parseInt","done","response","success","addClass","addNotification","type","fail","error","errorMsg","always"],"mappings":";;;;;;;AAuBAA,OAAO,qCAAA,CAAC,SAAU,YAAa,qBAAsB,SAASC,EAAGC,KAAMC,cACnE,MAAO,CACHC,KAAM,SAASC,UACXJ,EAAE,0BAA0BK,GAAG,SAAU,SAASC,GAC9CA,EAAEC,iBACFD,EAAEE,kBAEF,IAAIC,UAAYT,EAAE,qBAAqBU,MACnCC,QAAUX,EAAE,iBAAiBU,MAEjC,GAAKC,QAAQC,OAAb,CAQA,IAAIC,KAAOb,EAAE,sBACTc,QAAUd,EAAE,oBA8ChB,OA5CAa,KAAKE,KAAK,YAAY,GAAMC,KAAK,cACjCF,QAAQG,YAAY,8BAA8BD,KAAK,IAGvDf,KAAKiB,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFhB,SAAUA,SACVK,UAAWY,SAASZ,WACpBE,QAASA,SAEbW,KAAM,SAASC,UACPA,SAASC,SACTV,QAAQW,SAAS,uBAAuBT,KAAKO,SAASZ,SACtDX,EAAE,iBAAiBU,IAAI,IAEvBR,aAAawB,gBAAgB,CACzBf,QAASY,SAASZ,QAClBgB,KAAM,cAGVb,QAAQW,SAAS,sBAAsBT,KAAKO,SAASZ,SACrDT,aAAawB,gBAAgB,CACzBf,QAASY,SAASZ,QAClBgB,KAAM,UAGjB,EACDC,KAAM,SAASC,OACX,IAAIC,SAAW,wBACXD,MAAMlB,UACNmB,SAAWD,MAAMlB,SAErBG,QAAQW,SAAS,sBAAsBT,KAAKc,UAC5C5B,aAAawB,gBAAgB,CACzBf,QAASmB,SACTH,KAAM,SAEb,EACDI,OAAQ,WACJlB,KAAKE,KAAK,YAAY,GAAOC,KAAK,eACtC,MAGG,CAjDP,CALId,aAAawB,gBAAgB,CACzBf,QAAS,yBACTgB,KAAM,SAqDlB,EACJ,EAER"}